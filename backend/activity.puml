@startuml
|用户|
start
:提交代码/选择答案;
|系统|
:接收提交;
:保存提交记录;
:获取题目信息;

if (题目类型?) then (编程题)
  :获取测试用例;

  if (判题模式?) then (本地判题)
    :编译代码;

    if (编译成功?) then (是)
      :运行所有测试用例;
      :收集每个测试用例结果;
      :计算执行时间和内存使用;
    else (否)
      :记录编译错误;
      :设置状态为"编译错误";
    endif

  else (AI判题)
    :验证代码语法;

    if (语法正确?) then (是)
      :构建AI评估提示词;
      :调用AI服务评估代码;
      :解析AI响应结果;
      :提取测试用例执行信息;
    else (否)
      :获取错误信息;
      :设置状态为"编译错误";
    endif

  endif

  :计算通过率;

  if (全部通过?) then (是)
    :设置状态为"正确";
  else (否)
    if (运行时错误?) then (是)
      :设置状态为"运行时错误";
    else (否)
      :设置状态为"答案错误";
    endif
  endif

else if (题目类型?) then (选择题)
  :比对用户选择与正确答案;

  if (答案正确?) then (是)
    :设置状态为"正确";
  else (否)
    :设置状态为"答案错误";
  endif

else (判断题)
  :比对用户判断与正确答案;

  if (判断正确?) then (是)
    :设置状态为"正确";
  else (否)
    :设置状态为"答案错误";
  endif
endif

:更新提交状态;
:更新用户解题记录;

|用户|
:查看判题结果;


stop
@enduml